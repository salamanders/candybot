<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <link href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA/4QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAERERERERERERAAAAAAAAERAQAAAAAAEBEAEAAAAAEAEQABAAAAEAARAAAQAAEAABEAAAEAEAAAEQAAABEAAAARAAAAEQAAABEAAAEAEAAAEQAAEAABAAARAAEAAAAQABEAEAAAAAEAEQEAAAAAABAREAAAAAAAAREREREREREREAAAAAP/wAAF/6AABv9gAAd+4AAHveAAB9vgAAfn4AAH5+AAB9vgAAe94AAHfuAABv9gAAX/oAAD/8AAAAAAAA"
          rel="icon" type="image/x-icon"/>
    <title>FullWindow</title>

    <link href="./css/reset.css" media="all" rel="stylesheet"/>

    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.145.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.145.0/examples/jsm/",
          "tensorflow/": "https://cdn.jsdelivr.net/npm/@tensorflow/",
          "tensorflow-models/": "https://cdn.jsdelivr.net/npm/@tensorflow-models/",
          "three-nebula":"https://cdn.jsdelivr.net/npm/three-nebula"
        }
      }
    </script>

    <style>
        html, body {
            margin: 0;  /* Make sure that there is no margin around the canvas */
            overflow: hidden;  /* Make sure we don't get scroll bars. */
        }
    </style>

    <script type="module">
        import * as WEBCAM from "./modules/simple-webcam.mjs";
        import {blockUntilDOMReady} from "./modules/polyfill.mjs";
        import * as SCENE from "./modules/simple-scene.mjs"
        import * as POSE from "./modules/simple-pose.mjs"
        import {MovingStats} from "./modules/moving-stats.mjs";
        await Promise.all([blockUntilDOMReady(), WEBCAM.start()]);
        SCENE.setup();
        SCENE.addTexture(WEBCAM.video);

        await POSE.setup();

        const poseStats = new MovingStats('pose estimation');
        let currentPose = null;

        // Won't overrun because of await
        async function nextPose() {
            currentPose = await POSE.estimatePoses(WEBCAM.video);
            //console.log('pose', currentPose);
            poseStats.hit();
            setTimeout(nextPose, 100);
        }
        await nextPose();
    </script>
</head>
<body>
</body>
</html>